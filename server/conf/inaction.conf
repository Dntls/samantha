samantha.inaction {
  engineType = "RECOMMENDER"
  indexers = [
    {
      name = "loggerBasedIndexer"
      configClass = "org.grouplens.samantha.server.indexer.LoggerBasedIndexerConfig"
    }, {
      name = "userMovieDisplay"
      configClass = "org.grouplens.samantha.server.indexer.CSVFileIndexerConfig"
      indexType = "inactionUserMovieDisplay"
      filesKey = "files"
      separatorKey = "separator"
      dataFields = [
        "tstamp", "userId", "sessionId", "pageName", "pageSize", "dwell", "movieId", "rank",
        "click", "rating", "highRate", "lowRate", "trailer", "wishlist", "hover", "stop",
        "reason", "notice", "familiar", "when", "rate", "future", "skip",
      ]
      timestampField = "tstamp"
      daoName = "TimeFilteredDAO"
      daoNameKey = "entityDaoName"
      subDaoName = "CSVFileListEntityDAO"
      subDaoConfigKey = "subDaoConfig"
      beginTimeKey = "beginTime"
      endTimeKey = "endTime"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
    }, {
      name = "groupedUserMovieDisplay"
      configClass = "org.grouplens.samantha.server.indexer.GroupedIndexerConfig"
      dependedIndexer = "userMovieDisplay"
      filesKey = "files"
      separatorKey = "separator"
      dataFields = [
        "tstamp", "userId", "sessionId", "pageName", "pageSize", "dwell", "movieId", "rank",
        "click", "rating", "highRate", "lowRate", "trailer", "wishlist", "hover", "stop",
        "reason", "notice", "familiar", "when", "rate", "future", "skip",
      ]
      daoName = "CSVFileListEntityDAO"
      daoNameKey = "entityDaoName"
      groupKeys = ["userId"]
      orderFields = ["tstamp", "rank"]
      orderFieldsTypes = ["INT", "INT"]
      numBuckets = 500
      skip = true
      separator = "\t"
      dataDir = ${samantha.dataDir}"/inactionGroupedUserMovieDisplay"
      dataDirKey = "dataDir"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
    }, {
      name = "userMovieDisplaySequence"
      configClass = "org.grouplens.samantha.server.tensorflow.UserSequenceIndexerConfig"
      dependedIndexer = "groupedUserMovieDisplay"
      groupKeys = ["userId"]
      otherDataFields = [
        "tstamp", "sessionId", "pageName", "pageSize", "dwell", "movieId", "rank",
        "click", "rating", "highRate", "lowRate", "trailer", "wishlist", "hover", "stop",
        "reason", "notice", "familiar", "when", "rate", "future", "skip",
      ]
      filesKey = "files"
      filePath = ${samantha.dataDir}"/inactionUserMovieDisplaySequence.tsv"
      filePathKey = "filePath"
      separatorKey = "separator"
      daoName = "CSVFileListEntityDAO"
      daoNameKey = "entityDaoName"
      separator = "\t"
      innerFieldSeparator = ","
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
    }, {
      name = "inactionUserMovieSurvey"
      configClass = "org.grouplens.samantha.server.indexer.CSVFileIndexerConfig"
      indexType = "inactionUserMovieSurveyForR"
      filesKey = "files"
      separatorKey = "separator"
      dataFields = ["futureSur", "inactionSur", "skipSur", "detailInactionSur", "rateSur", "whenSur", "noticeSur", "familiarSur", "reasonSur", "actionPage", "lowRatePage", "colPage", "dwellPage", "namePage", "ratingPage", "negativeRatePage", "hoverRatePage", "highRatePage", "closestInvDistPage", "wishlistRatePage", "positiveRatePage", "actionRatePage", "closestRowPage", "rowPage", "clickPage", "hoverPage", "sizePage", "clickRatePage", "positivePage", "closestColPage", "closestActionPage", "wishlistPage", "lowRateRatePage", "stopRatePage", "stopPage", "highRateRatePage", "negativePage", "ratingRatePage", "tstamp", "movieId", "numFrontShowOutSess", "stopSess", "clickSess", "invReviewDistOutSess", "dwellPrevShowSess", "clickRateSess", "lengthSess", "numShowSess", "stopRateSess", "namePrevShowSess", "highRateRateSess", "numReviewSess", "hoverSess", "lowRateSess", "rowPrevShowSess", "numFrontShowSess", "actionRateSess", "numExploreShowOutSess", "actionSess", "numShowOutSess", "wishlistSess", "invReviewDistSess", "highRateSess", "lowRateRateSess", "numExploreShowSess", "numReviewOutSess", "wishlistRateSess", "ratingRateSess", "positiveRateSess", "sizePrevShowSess", "hoverRateSess", "meanNumItemSess", "numItemSess", "negativeRateSess", "positiveSess", "colPrevShowSess", "ratingSess", "negativeSess", "meanNumItemHist", "actionHist", "highRateHist", "actionRateHist", "numItemHist", "wishlistRateHist", "hoverRateHist", "hoverHist", "numFrontShowHist", "wishlistHist", "positiveRateHist", "numReviewHist", "lengthHist", "lowRateRateHist", "negativeHist", "clickRateHist", "stopHist", "positiveHist", "highRateRateHist", "invReviewDistHist", "stopRateHist", "ratingHist", "lowRateHist", "ratingRateHist", "negativeRateHist", "numShowHist", "clickHist", "numExploreShowHist", "userId", "namePrev", "sizePrev", "dwellPrev", "colPrev", "rowPrev", "hover"]
      timestampField = "timestamp"
      daoName = "TimeFilteredDAO"
      daoNameKey = "entityDaoName"
      subDaoName = "CSVFileListEntityDAO"
      subDaoConfigKey = "subDaoConfig"
      beginTimeKey = "beginTime"
      endTimeKey = "endTime"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
      expandersConfig = [
        {
          expanderClass = "org.grouplens.samantha.server.expander.LogicalExpander"
          sourceAttrs = ["click", "highRate", "trailer", "wishlist"]
          valueAttr = "positive"
          separator = ","
          joiner = ","
          or = true
        }, {
          expanderClass = "org.grouplens.samantha.server.expander.LogicalExpander"
          sourceAttrs = ["stop", "lowRate"]
          valueAttr = "negative"
          separator = ","
          joiner = ","
          or = true
        }, {
          expanderClass = "org.grouplens.samantha.server.expander.LogicalExpander"
          sourceAttrs = ["click", "highRate", "trailer", "wishlist", "stop", "lowRate"]
          valueAttr = "action"
          separator = ","
          joiner = ","
          or = true
        }, {
          expanderClass = "org.grouplens.samantha.server.inaction.LabelExpander"
          labelAttr = "reason"
          excludedLabels = ["NoPop"]
          #splitTstamp = 1517464800 #2018-02-01
          backward = false
        }
      ]
      otherExpanders = [{
        expanderClass = "org.grouplens.samantha.server.inaction.SequenceToStepExpander"
        nameAttrs = [
          "notice",
          "tstamp", "sessionId", "pageName", "pageSize", "dwell", "movieId", "rank",
          "click", "rating", "highRate", "lowRate", "trailer", "wishlist", "hover", "stop",
          "positive", "negative", "action",
          "reason", "familiar", "when", "rate", "future", "skip",
        ]
        valueAttrs = [
          "notice",
          "tstamp", "sessionId", "pageName", "pageSize", "dwell", "movieId", "rank",
          "click", "rating", "highRate", "lowRate", "trailer", "wishlist", "hover", "stop",
          "positive", "negative", "action",
          "reason", "familiar", "when", "rate", "future", "skip",
        ]
        excludedLabels = ["NoPop"] #["NoPop", "Invalid", "NotReached", "FreeText"]
        historyAttrs = [
          "notices",
          "tstamps", "sessionIds", "pageNames", "pageSizes", "dwells", "movieIds", "ranks",
          "clicks", "ratings", "highRates", "lowRates", "trailers", "wishlists", "hovers", "stops",
          "positives", "negatives", "actions",
          "reasons", "familiars", "whens", "rates", "futures", "skips",
        ]
        separator = ","
        joiner = ","
      }]
    }
  ]
  retrievers = []
  predictors = [
    {
      name = "noticeXGBoostPredictor"
      configClass = "org.grouplens.samantha.xgboost.XGBoostPredictorConfig"
      modelName = "noticeXGBoostPredictorModel"
      modelFile = ${samantha.modelDir}"/noticeXGBoostPredictorModel.bin"
      labelName = "noticedClass"
      weightName = "weight"
      entityDaosConfig = ${samantha.entityDaosConfig}
      daoConfigKey = "daoConfig"
      expandersConfig = [
        {
          expanderClass = "org.grouplens.samantha.server.inaction.InactionExpander"
          labelAttr = "noticedSur"
          includedLabels = ["Noticed", "NotNoticed"]
        }
      ]
      featurizer {
        featureExtractorList = [
          {
            extractorConfigClass = "org.grouplens.samantha.server.inaction.TreeFeatureExtractorConfig"
            labelAttr = "noticedSur"
            labelClass = "noticedClass"
          }
        ]
      }
      features = ["actionPage", "lowRatePage", "colPage", "dwellPage", "namePage", "ratingPage", "negativeRatePage", "hoverRatePage", "highRatePage", "closestInvDistPage", "wishlistRatePage", "positiveRatePage", "actionRatePage", "closestRowPage", "rowPage", "clickPage", "hoverPage", "sizePage", "clickRatePage", "positivePage", "closestColPage", "closestActionPage", "wishlistPage", "lowRateRatePage", "stopRatePage", "stopPage", "highRateRatePage", "negativePage", "ratingRatePage", "movieId", "numFrontShowOutSess", "stopSess", "clickSess", "invReviewDistOutSess", "dwellPrevShowSess", "clickRateSess", "lengthSess", "numShowSess", "stopRateSess", "namePrevShowSess", "highRateRateSess", "numReviewSess", "hoverSess", "lowRateSess", "rowPrevShowSess", "numFrontShowSess", "actionRateSess", "numExploreShowOutSess", "actionSess", "numShowOutSess", "wishlistSess", "invReviewDistSess", "highRateSess", "lowRateRateSess", "numExploreShowSess", "numReviewOutSess", "wishlistRateSess", "ratingRateSess", "positiveRateSess", "sizePrevShowSess", "hoverRateSess", "meanNumItemSess", "numItemSess", "negativeRateSess", "positiveSess", "colPrevShowSess", "ratingSess", "negativeSess", "meanNumItemHist", "actionHist", "highRateHist", "actionRateHist", "numItemHist", "wishlistRateHist", "hoverRateHist", "hoverHist", "numFrontShowHist", "wishlistHist", "positiveRateHist", "numReviewHist", "lengthHist", "lowRateRateHist", "negativeHist", "clickRateHist", "stopHist", "positiveHist", "highRateRateHist", "invReviewDistHist", "stopRateHist", "ratingHist", "lowRateHist", "ratingRateHist", "negativeRateHist", "numShowHist", "clickHist", "numExploreShowHist", "userId", "namePrev", "sizePrev", "dwellPrev", "colPrev", "rowPrev", "hover"]
      numTrees = 500
      methodConfig {
        objective = "binary:logistic"
        eval_metric = "logloss"
        #objective = "multi:softprob"
        #eval_metric = "merror"
        #num_class = 5
        verbose = false
        silent = 1
        #tree_method = "exact"
      }
    }
  ]
  others = [
    {
      name = "inactionXGBoostPredictor"
    }, {
      name = "futureXGBoostPredictor"
    }, {
      name = "actionFMPredictor"
    }, {
      name = "actionFMPredictorWithInaction"
    }, {
      name = "actionXGBoostPredictor"
    }, {
      name = "actionXGBoostPredictorWithInaction"
    }
  ]
  rankers = []
  recommenders = []
  router {
    configClass = "org.grouplens.samantha.server.router.BasicRouterConfig"
    recommenderKey = "recommender"
    predictorKey = "predictor"
  }
  evaluators = [
    {
      name = "BinaryClassificationEvaluator"
      configClass = "org.grouplens.samantha.server.evaluator.PredictionEvaluatorConfig"
      predictionIndexers = []
      indexers = ["loggerBasedIndexer"]
      predictorKey = "predictor"
      groupKeys = ["userId"]
      entityDaosConfig = ${samantha.entityDaosConfig}
      daoConfigKey = "evaluatorDaoConfig"
      metrics = [
        {
          metricConfigClass = "org.grouplens.samantha.server.evaluator.metric.AUCConfig"
          labelName = "positive"
          labelKey = "labelAttr"
          aucType = "GLOBAL"
        }
      ]
    }, {
      name = "RecommendationEvaluator"
      configClass = "org.grouplens.samantha.server.evaluator.RecommendationEvaluatorConfig"
      recommendationIndexers = []
      indexers = ["loggerBasedIndexer"]
      recommenderKey = "recommender"
      entityDaosConfig = ${samantha.entityDaosConfig}
      daoConfigKey = "evaluatorDaoConfig"
      groupKeys = ["userId"]
      metrics = [
        {
          metricConfigClass = "org.grouplens.samantha.server.evaluator.metric.MAPConfig"
          itemKeys = ["movieIdEval"]
          recKeys = ["movieId"]
          #relevanceKey = "action"
          #threshold = 0.5
          N = [5, 8, 20, 24]
        }
      ]
    }
  ]
  schedulers = []
}
