samantha.entityDaosConfig.TimeFilteredDAO {
  daoConfigClass = "org.grouplens.samantha.server.dao.TimeFilteredDAOConfig"
  entityDaosConfig = ${samantha.simpleDaosConfig}
  timestampField = "unixReviewTime"
  beginTimeKey = "beginTime"
  endTimeKey = "endTime"
  subDaoConfigKey = "subDaoConfig"
}

samantha.glocal {
  engineType = "RECOMMENDER"
  indexers = [
    {
      name = "loggerBasedIndexer"
      configClass = "org.grouplens.samantha.server.indexer.LoggerBasedIndexerConfig"
    }, {
      name = "tensorFlowFeaturizedJsonBatch"
      configClass = "org.grouplens.samantha.server.indexer.JsonFileIndexerConfig"
      indexType = "glocalTensorFlowFeaturizedJsonBatchTstamp"
      filesKey = "files"
      timestampField = "tstamp"
      daoName = "TimeFilteredDAO"
      daoNameKey = "entityDaoName"
      subDaoName = "JsonFileListEntityDAO"
      subDaoConfigKey = "subDaoConfig"
      beginTimeKey = "beginTime"
      endTimeKey = "endTime"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
      dataSubscribers = []
    }, {
      name = "featurizedItemAttributeRelation"
      configClass = "org.grouplens.samantha.server.indexer.JsonFileIndexerConfig"
      indexType = "glocalFeaturizedItemAttributeRelationTstamp"
      filesKey = "files"
      timestampField = "tstamp"
      daoName = "TimeFilteredDAO"
      daoNameKey = "entityDaoName"
      subDaoName = "JsonFileListEntityDAO"
      subDaoConfigKey = "subDaoConfig"
      beginTimeKey = "beginTime"
      endTimeKey = "endTime"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
      dataSubscribers = []
    }, {
      name = "userPlaceReview"
      configClass = "org.grouplens.samantha.server.indexer.CSVFileIndexerConfig"
      indexType = "glocalUserPlaceReview"
      filesKey = "files"
      separatorKey = "separator"
      dataFields = ["unixReviewTime", "gPlusUserId", "gPlusPlaceId", "city", "rating"]
      timestampField = "unixReviewTime"
      daoName = "TimeFilteredDAO"
      daoNameKey = "entityDaoName"
      subDaoName = "CSVFileListEntityDAO"
      subDaoConfigKey = "subDaoConfig"
      beginTimeKey = "beginTime"
      endTimeKey = "endTime"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
      dataSubscribers = []
      expandersConfig = [
        {
          expanderClass = "org.grouplens.samantha.server.expander.MapItemId2InfoExpander"
          modelName = "glocalTFIDFPlaceInfoModel"
          idField = "gPlusPlaceId"
          infoFields = ["city"]
        }
      ]
    }, {
      name = "groupedUserPlaceReview"
      configClass = "org.grouplens.samantha.server.indexer.GroupedIndexerConfig"
      dependedIndexer = "userPlaceReview"
      dataFields = ["unixReviewTime", "gPlusUserId", "gPlusPlaceId", "city", "rating"]
      filesKey = "files"
      separatorKey = "separator"
      daoName = "CSVFileListEntityDAO"
      daoNameKey = "entityDaoName"
      groupKeys = ["gPlusUserId"]
      orderFields = ["unixReviewTime"]
      orderFieldsTypes = ["INT"]
      numBuckets = 500
      skip = true
      separator = "\t"
      dataDir = ${samantha.dataDir}"/glocalGroupedUserPlaceReview"
      dataDirKey = "dataDir"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
    }, {
      name = "userPlaceReviewSequence"
      configClass = "org.grouplens.samantha.server.tensorflow.UserSequenceIndexerConfig"
      dependedIndexer = "groupedUserPlaceReview"
      groupKeys = ["gPlusUserId"]
      otherDataFields = ["unixReviewTime", "gPlusPlaceId", "city", "rating"]
      filesKey = "files"
      filePath = ${samantha.dataDir}"/glocalUserPlaceReviewSequence.tsv"
      filePathKey = "filePath"
      separatorKey = "separator"
      daoName = "CSVFileListEntityDAO"
      daoNameKey = "entityDaoName"
      separator = "\t"
      innerFieldSeparator = "<>"
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
    }, {
      name = "userSequenceTensorFlowBatch"
      configClass = "org.grouplens.samantha.server.tensorflow.TensorFlowBatchIndexerConfig"
      dependedIndexer = "tensorFlowFeaturizedJsonBatch"
      tensorFlowPredictor = "glocalTensorFlowReviewPredictor"
      tensorFlowModel = "glocalTensorFlowReviewPredictorModel"
      timestampField = "tstamp"
      batchSize = 32
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
    }, {
      name = "itemAttributeTensorFlowBatch"
      configClass = "org.grouplens.samantha.server.tensorflow.TensorFlowBatchIndexerConfig"
      dependedIndexer = "featurizedItemAttributeRelation"
      tensorFlowPredictor = "glocalTensorFlowReviewPredictor"
      tensorFlowModel = "glocalTensorFlowReviewPredictorModel"
      timestampField = "tstamp"
      batchSize = 32
      daoConfigKey = "daoConfig"
      entityDaosConfig = ${samantha.entityDaosConfig}
    }
  ]
  retrievers = []
  predictors = [
    {
      name = "glocalTensorFlowReviewPredictor"
      configClass = "org.grouplens.samantha.server.tensorflow.TensorFlowPredictorConfig"
      modelName = "glocalTensorFlowReviewPredictorModel"
      modelFile = ${samantha.modelDir}"/glocalTensorFlowReviewPredictorModel.bin"
      graphDefFilePath = ${samantha.modelDir}"/tensorflow.graph"
      entityDaosConfig = ${samantha.entityDaosConfig}
      daoConfigKey = "daoConfig"
      evaluatorNames = []
      updateOper = "update_op"
      lossOper = "metrics/train_loss_op"
      initOper = "init_op"
      outputOper = "prediction/item_pred_op"
      topKOper = "prediction/item_top_k_op"
      topKId = "topKId"
      topKValue = "topKValue"
      itemIndex = "GPLUS_PLACE_ID"
      indexKeys = ["GPLUS_USER_ID", "GPLUS_PLACE_ID", "CITY", "SEQ_LEN", "TSTAMP"]
      expandersConfig = [
        {
          expanderClass = "org.grouplens.samantha.server.expander.MapItemId2InfoExpander"
          modelName = "glocalTFIDFPlaceInfoModel"
          modelFile = ${samantha.modelDir}"/glocalTFIDFPlaceInfoModel.bin"
          idField = "gPlusPlaceId"
          infoFields = ["city"]
          daoConfigKey = "daoConfig"
          entityDaosConfig = ${samantha.entityDaosConfig}
        }
      ]
      #equalSizeChecks = [
      #  {
      #    "featuresWithEqualSizes": ["item", "city"]
      #  }, {
      #    "featuresWithEqualSizes": ["user", "sequence_length"]
      #  }
      #]
      featurizer {
        featureExtractorList = [
          {
            extractorConfigClass = "org.grouplens.samantha.server.featurizer.StringValueExtractorConfig"
            indexName = "GPLUS_USER_ID"
            attrName = "gPlusUserId"
            feaName = "user"
          }, {
            extractorConfigClass = "org.grouplens.samantha.server.featurizer.SeparatedStringExtractorConfig"
            indexName = "GPLUS_PLACE_ID"
            attrName = "gPlusPlaceId"
            feaName = "item"
            separator = "<>"
            normalize = false
            fillIn = "null"
            maxFeatures = 150
          }, {
            extractorConfigClass = "org.grouplens.samantha.server.featurizer.SeparatedStringExtractorConfig"
            indexName = "CITY"
            attrName = "city"
            feaName = "city"
            separator = "<>"
            normalize = false
            fillIn = "null"
            maxFeatures = 150
          }, {
            extractorConfigClass = "org.grouplens.samantha.server.featurizer.SeparatedStringSizeExtractorConfig"
            indexName = "SEQ_LEN"
            attrName = "gPlusPlaceId"
            feaName = "sequence_length"
            separator = "<>"
            maxFeatures = 150
          }, {
            extractorConfigClass = "org.grouplens.samantha.server.featurizer.SeparatedIdentityExtractorConfig"
            indexName = "TSTAMP"
            attrName = "unixReviewTime"
            feaName = "tstamp"
            separator = "<>"
            maxFeatures = 150
          }
        ]
      }
      onlineMethodConfig {
        methodClass = "org.grouplens.samantha.server.solver.TensorFlowMethodConfig"
      }
      methodConfig {
        methodClass = "org.grouplens.samantha.server.solver.TensorFlowMethodConfig"
        maxIter = 20
      }
    }
  ]
  rankers = []
  recommenders = []
  router {
    configClass = "org.grouplens.samantha.server.router.BasicRouterConfig"
    recommenderKey = "recommender"
    predictorKey = "predictor"
  }
  evaluators = []
  schedulers = []
}
